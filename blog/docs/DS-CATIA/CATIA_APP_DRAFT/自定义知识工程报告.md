
# 自定义知识工程报告

由于CATIA Drafting中原生的物料清单报表（BOM – Bill Of Material）在使用平台自带原生功能（标准中对物料清单形式。统计属性等进行订制）进行订制时，可订制的功能和范围非常有限，如需订制程度比较深，往往需要二次开发，成本比较高，而且在平台升级版本后，二次开发的内容非常难迁移到升版的平台上。
所以达索针对这种情况一般建议客户使用EKL的方式进行订制，也就是这里所说的知识工程报告（Knowledge Report）。这样做的好处是一方面EKL的开发成本远低于CAA二次开发，同时EKL订制内容可以无缝迁移到升版后的平台上。
知识工程报告是CATIA中更为灵活的报表形式，支持EKL代码扩展，可定义报表模板，存储在平台中，进行随时调用。

## 在Know-how Reuse应用中定义知识工程报告模板

![](自定义知识工程报告\2022-10-01-23-28-11.png)

在 Civil Engineer角色中选择Know-how Reuse应用

打开该应用界面后，点击报告定义，弹出下列对话框：

![](自定义知识工程报告\2022-10-01-23-29-07.png)

首先定义报告标题：

![](自定义知识工程报告\2022-10-01-23-29-18.png)

然后选择报告模板中想要统计的属性：

![](自定义知识工程报告\2022-10-01-23-29-31.png)

![](自定义知识工程报告\2022-10-01-23-29-39.png)

如果已经实现知道想要统计的属性在哪一种类型中（如管路类型、电气类型、part类型等），则可在类型栏中直接选择那一种类型，然后在属性栏中选择对应属性。
这种方法的好处是：由于不需要在最顶层节点开始往下遍历属性，直接定位至对应类型中，可减少报表统计时的时间。但是前提是需要用户知道这种属性是在哪一种零件类型下。
如果实在不知道想要统计的属性在哪种零件类型中，则可在类型栏中直接选择最顶层节点 Product Occurrence，这个节点下包含所有零件类型。然后在属性栏中寻找对应属性。

![](自定义知识工程报告\2022-10-01-23-29-52.png)

这种方法的好处是不需要对属性所属的零件类型进行精确定位，但是由于选择的最顶层节点，在生成报告时会遍历所有零件类型去寻找特定属性，会增加报表统计的时间。

选择好属性之后，点击旁边的添加按钮，即可将属性添加至下面一栏中
并可对添加进来的属性栏进行编辑：

![](自定义知识工程报告\2022-10-01-23-30-05.png)

如可对管道长度属性添加一个求和运算，可对管道总长度进行统计。

![](自定义知识工程报告\2022-10-01-23-30-14.png)

对管道Nominal Size属性添加分组依据，即在分组依据栏中选择是。这个意思是将Nominal Size相同的管道零件全部合并到同一行进行统计。

![](自定义知识工程报告\2022-10-01-23-30-26.png)

对Nominal Size属性添加计数运算，即统计不同Nominal Size值的管道数量。

另外，也可创建表达式：

![](自定义知识工程报告\2022-10-01-23-30-36.png)

![](自定义知识工程报告\2022-10-01-23-30-43.png)

选择输出类型，也就是想要用EKL代码提取的属性是哪一种变量：

![](自定义知识工程报告\2022-10-01-23-30-50.png)

点击创建、编辑表达式：

![](自定义知识工程报告\2022-10-01-23-31-02.png)

b. 举例：用户有些情况下需要将不同统计属性合并到同一列中，而不是分到不同列中进行统计，这时可以用到创建表达式这一功能
首先在属性栏中选择管道管道（Piping Pipe）这一类型属性:

![](自定义知识工程报告\2022-10-01-23-31-14.png)

点击创建表达式，选择字符串类型（选择合并的属性是字符串类型）：

![](自定义知识工程报告\2022-10-01-23-31-21.png)

点击创建/编辑表达式：

![](自定义知识工程报告\2022-10-01-23-31-31.png)

代码解释：

```java

let str1(string)     #创建一个字符串变量
let str2(string)    #创建一个字符串变量
let l1(length)   #创建一个长度变量
str1=ThisObject.V_Standard     #让该变量等于模型中standard这一属性
str2=ThisObject.V_NominalSize    #让该变量等于模型中NominalSize这一属性
l1=ThisObject.V_OutsideDiameter      # 让该变量等于模型中OutsideDiameter这一属性
set Attribute="标准为"+str1+","+"外径D="+l1+","+"公称直径为"+str2         #合并这三个属性到同一列

```

检查是否有错误：

![](自定义知识工程报告\2022-10-01-23-32-10.png)

点击应用：

![](自定义知识工程报告\2022-10-01-23-32-21.png)

双击列标题中的选项进行修改，改为“型号与规格”：

![](自定义知识工程报告\2022-10-01-23-32-33.png)

点击右下角的报告预览：

![](自定义知识工程报告\2022-10-01-23-32-41.png)

此报告预览是针对于当前页面中的模型进行统计。

返回报告模板页面，将该报告模板另存：

![](自定义知识工程报告\2022-10-01-23-32-52.png)

## 在drafting中调用报告模板

然后在CATIA Drafting中进行调用：

![](自定义知识工程报告\2022-10-01-23-33-30.png)

点击知识工程报表：

![](自定义知识工程报告\2022-10-01-23-33-37.png)

一般来说都是选择选定的对象，即某一个视图
然后选择要使用的报告模板：

![](自定义知识工程报告\2022-10-01-23-33-45.png)

当报告模板创建好之后，一般来说可能需要过几分钟才能搜到该报告模板

也可使用高级搜索功能，直接检索所有数据库中已存的所有报告模板：

![](自定义知识工程报告\2022-10-01-23-33-56.png)

选择好模板之后，再选择某个视图（或之前选好也可以），点选视图当中的空白处，即可基于该视图生成一个知识工程报告：

![](自定义知识工程报告\2022-10-01-23-34-05.png)

注：
（1） 知识工程报告中的序号与Drafting中零件序号自动生成命令中的序号并没有对应关系。在OOTB功能下，用户必须使用手动标号的方法与知识工程报告中的序号产生对应关系。
（2） 也可将报告模板直接挂接在Data Setup中，之后使用时直接调用即可，不再需要搜索

![](自定义知识工程报告\2022-10-01-23-34-14.png)

选择报告模板定义目录（Report Template Definition Catalog），右键点击创建新的资源表

![](自定义知识工程报告\2022-10-01-23-34-24.png)

双击资源栏下的 （取消设置），搜索数据库中的报告模板，进行挂接：

![](自定义知识工程报告\2022-10-01-23-34-33.png)

然后将新建好的资源集挂接到左边一栏中对应的合作区中，ctrl+s保存：

![](自定义知识工程报告\2022-10-01-23-34-43.png)

这时我们在Drafting中再调用知识工程模板时，已经可以直接调用：

![](自定义知识工程报告\2022-10-01-23-34-51.png)

（3）用EKL代码 创建表达式还有很多案例，这里不作一一详细介绍。
